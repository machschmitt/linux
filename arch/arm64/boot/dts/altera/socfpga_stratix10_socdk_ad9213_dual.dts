/dts-v1/;
#include "socfpga_stratix10_socdk.dts"
#include <dt-bindings/iio/frequency/ad9528.h>

#define AD9213_JESD_L	16
#define AD9213_JESD_M	1
#define AD9213_JESD_F	2
#define AD9213_JESD_S	16
#define AD9213_JESD_HD	0
#define AD9213_JESD_N	16
#define AD9213_JESD_NP	16
#define AD9213_JESD_CS	0
#define AD9213_JESD_K	32
#define AD9213_JESD_SUBCLASS	1

/ {
	clocks {
		sys_clk: sys_clk {
			#clock-cells = <0>;
			compatible = "fixed-clock";
			clock-frequency = <100000000>;
			clock-output-names = "system_clock";
		};

		dma_clk: dma_clk {
			#clock-cells = <0x0>;
			compatible = "fixed-clock";
			clock-frequency = <250000000>;
			clock-output-names = "dma_clk";
		};

		adf_clk_out: adf_clk_out {
			#clock-cells = <0>;
			compatible = "fixed-clock";
			clock-frequency = /bits/ 64 <10000000000>;
			clock-output-names = "adf_clk_out";
		};
	};

	soc {
		sys_hps_bridges: bridge@ff200000 {
			compatible = "simple-bus";
			reg = <0xf9000000 0x02000000>;
			#address-cells = <1>;
			#size-cells = <1>;
			ranges = <0x00000000 0xf9000000 0x02000000>;

			ltc6952_spi: spi@200 {
				compatible = "altr,spi-1.0";
				reg = <0x00000200 0x00000020>;
				interrupt-parent = <&intc>;
				interrupts = <0 34 4>;
				#address-cells = <0x1>;
				#size-cells = <0x0>;

				ltc6952: ltc6952@0 {
					compatible = "adi,ltc6952";
					reg = <0>;

					#address-cells = <1>;
					#size-cells = <0>;

					spi-max-frequency = <10000000>;

					jesd204-device;
					#jesd204-cells = <2>;
					jesd204-sysref-provider;

					clock-output-names = "ltc6952_0_out0", "ltc6952_0_out1",
						"ltc6952_0_out2", "ltc6952_0_out3", "ltc6952_0_out4",
						"ltc6952_0_out5", "ltc6952_0_out6", "ltc6952_0_out7",
						"ltc6952_0_out8", "ltc6952_0_out9", "ltc6952_0_out10",
						"ltc6952_0_out11";
					#clock-cells = <1>;

					adi,vco-frequency-hz = <3750000000>;
					adi,ref-frequency-hz = <500000000>;

					adi,charge-pump-microamp = <1000>;

					ltc6952_c0: channel@0 {
						reg = <0>;
						adi,extended-name = "SYSREF_0";
						adi,divider = <768>;
						adi,digital-delay = <0>;
						adi,analog-delay = <0>;
						adi,sysref;
					};

					ltc6952_c1: channel@1 {
						reg = <1>;
						adi,extended-name = "SYSREF_1";
						adi,divider = <768>;
						adi,digital-delay = <0>;
						adi,analog-delay = <0>;
						adi,sysref;
					};

					ltc6952_c4: channel@4 {	// fpga device clock
						reg = <4>;
						adi,extended-name = "FMC_P1_GBTCLK1M2C";
						adi,divider = <12>;
						adi,digital-delay = <0>;
						adi,analog-delay = <0>;
					};

					ltc6952_c5: channel@5 {
						reg = <5>;	// fpga sysref
						adi,extended-name = "FMC_P1_GBTCLK3M2C";
						//adi,divider = <12>;
						adi,divider = <768>;
						adi,digital-delay = <0>;
						adi,analog-delay = <0>;
					};

					ltc6952_c6: channel@6 {
						reg = <6>;	// fpga reference clock 1
						adi,extended-name = "FMC_P2_GBTCLK1M2C";
						adi,divider = <12>;
						adi,digital-delay = <0>;
						adi,analog-delay = <0>;
					};

					ltc6952_c7: channel@7 {
						reg = <7>;
						adi,extended-name = "FMC_P2_GBTCLK3M2C";
						adi,divider = <12>;
						adi,digital-delay = <0>;
						adi,analog-delay = <0>;
					};

					ltc6952_c8: channel@8 {
						reg = <8>;	// fpga reference clock 2
						adi,extended-name = "CLK_COPY";
						adi,divider = <12>;
						adi,digital-delay = <0>;
						adi,analog-delay = <0>;
					};
				};

				ltc6946: ltc6946@1 {
					compatible = "adi,ltc6946";
					reg = <1>;

					#address-cells = <1>;
					#size-cells = <0>;

					spi-max-frequency = <1000000>;

					clocks = <&sys_clk>;
					clock-names = "fref";

					#clock-cells = <0>;
				};
			};

			adf4371_spi: spi@400 {
				compatible = "altr,spi-1.0";
				reg = <0x00000400 0x00000020>;
				interrupt-parent = <&intc>;
				interrupts = <0 33 4>;
				#address-cells = <0x1>;
				#size-cells = <0x0>;


				adf4377_0: adf4377_0@0 {
					compatible = "adi,adf4377";
					reg = <0>;

					#address-cells = <1>;
					#size-cells = <0>;

					spi-max-frequency = <1000000>;
				};

				adf4377_1: adf4377_1@1 {
					compatible = "adi,adf4377";
					reg = <1>;

					#address-cells = <1>;
					#size-cells = <0>;

					spi-max-frequency = <1000000>;
				};
			};

			sys_gpio_out: gpio@20 {
				compatible = "altr,pio-1.0";
				reg = <0x00000020 0x00000010>;
				altr,gpio-bank-width = <32>;
				resetvalue = <0>;
				#gpio-cells = <2>;
				gpio-controller;
			};

			sys_spi: spi@40 {
				compatible = "altr,spi-1.0";
				reg = <0x00000040 0x00000020>;
				interrupt-parent = <&intc>;
				interrupts = <0 24 4>;
				#address-cells = <0x1>;
				#size-cells = <0x0>;

				ad9213_0: ad9213_0@0 {
					compatible = "adi,ad9213";
					reg = <0>;

					#address-cells = <1>;
					#size-cells = <0>;

					spi-max-frequency = <10000000>;

					reset-gpios = <&sys_gpio_out 0 0>;

					clocks = <&adf_clk_out>, <&ad9213_0_jesd>, <&ltc6952 8>;
					clock-names = "sample_clk", "jesd_clk", "core_clk";

					adi,lmfc-offset = <0>;

					adi,lanes-per-device = <AD9213_JESD_L>;
					adi,converters-per-device = <AD9213_JESD_M>;
					adi,octets-per-frame = <AD9213_JESD_F>;
					adi,samples-per-converter-per-frame = <AD9213_JESD_S>;
					adi,high-density = <AD9213_JESD_HD>;
					adi,converter-resolution = <AD9213_JESD_N>;
					adi,bits-per-sample = <AD9213_JESD_NP>;
					adi,control-bits-per-sample = <AD9213_JESD_CS>;
					adi,frames-per-multiframe = <AD9213_JESD_K>;
					adi,subclass = <AD9213_JESD_SUBCLASS>;


					jesd204-device;
					#jesd204-cells = <2>;
					jesd204-top-device = <0>;
					jesd204-link-ids = <0>;

					jesd204-inputs = <&ltc6952 0 0>,
						<&ad9213_1 0 0>;
				};

				ad9213_1: ad9213_1@1 {
					compatible = "adi,ad9213";
					reg = <1>;

					#address-cells = <1>;
					#size-cells = <0>;

					spi-max-frequency = <10000000>;

					reset-gpios = <&sys_gpio_out 1 0>;

					clocks = <&adf_clk_out>, <&ad9213_1_jesd>, <&ltc6952 8>;
					clock-names = "sample_clk", "jesd_clk", "core_clk";

					adi,lmfc-offset = <0>;

					adi,lanes-per-device = <AD9213_JESD_L>;
					adi,converters-per-device = <AD9213_JESD_M>;
					adi,octets-per-frame = <AD9213_JESD_F>;
					adi,samples-per-converter-per-frame = <AD9213_JESD_S>;
					adi,high-density = <AD9213_JESD_HD>;
					adi,converter-resolution = <AD9213_JESD_N>;
					adi,bits-per-sample = <AD9213_JESD_NP>;
					adi,control-bits-per-sample = <AD9213_JESD_CS>;
					adi,frames-per-multiframe = <AD9213_JESD_K>;
					adi,subclass = <AD9213_JESD_SUBCLASS>;

					jesd204-device;
					#jesd204-cells = <2>;

					jesd204-inputs = <&ltc6952 0 0>;
				};
			};

			ad9213_0_link_pll: ad9213_0_link_pll@60000 {
				compatible = "altr,fpll";
				reg = <0x00060000 0x2000>;
				clocks = <&ltc6952 4>;

				adi,stratix10;

				#clock-cells = <0>;
				clock-output-names = "jesd204_ad9213_0_link_clock";
			};

			ad9213_1_link_pll: ad9213_1_link_pll@A0000 {
				compatible = "altr,fpll";
				reg = <0x000A0000 0x2000>;
				clocks = <&ltc6952 4>;

				adi,stratix10;

				#clock-cells = <0>;
				clock-output-names = "jesd204_ad9213_1_link_clock";
			};

			ad9213_0_adxcvr: ad9213_0_adxcvr@C4000 {
				compatible = "adi,altera-adxcvr-1.00.a";
				reg = <0x000C4000 0x00001000>,
					<0x00040000 0x00002000>,
					<0x00042000 0x00002000>,
					<0x00044000 0x00002000>,
					<0x00046000 0x00002000>,
					<0x00048000 0x00002000>,
					<0x0004A000 0x00002000>,
					<0x0004C000 0x00002000>,
					<0x0004E000 0x00002000>,
					<0x00050000 0x00002000>,
					<0x00052000 0x00002000>,
					<0x00054000 0x00002000>,
					<0x00056000 0x00002000>,
					<0x00058000 0x00002000>,
					<0x0005A000 0x00002000>,
					<0x0005C000 0x00002000>,
					<0x0005E000 0x00002000>;
				reg-names = "adxcvr", "adxcfg-0", "adxcfg-1", "adxcfg-2",
					"adxcfg-3", "adxcfg-4", "adxcfg-5", "adxcfg-6",
					"adxcfg-7", "adxcfg-8", "adxcfg-9", "adxcfg-10",
					"adxcfg-11", "adxcfg-12", "adxcfg-13", "adxcfg-14",
					"adxcfg-15";

				adi,stratix10;

				clocks = <&ltc6952 4>, <&ad9213_0_link_pll>;
				clock-names = "ref", "link";

				#clock-cells = <0>;
				clock-output-names = "jesd204_0_lane_clock";
			};

			ad9213_1_adxcvr: ad9213_1_adxcvr@CC000 {
				compatible = "adi,altera-adxcvr-1.00.a";
				reg = <0x000CC000 0x00001000>,
					<0x00080000 0x00002000>,
					<0x00082000 0x00002000>,
					<0x00084000 0x00002000>,
					<0x00086000 0x00002000>,
					<0x00088000 0x00002000>,
					<0x0008A000 0x00002000>,
					<0x0008C000 0x00002000>,
					<0x0008E000 0x00002000>,
					<0x00090000 0x00002000>,
					<0x00092000 0x00002000>,
					<0x00094000 0x00002000>,
					<0x00096000 0x00002000>,
					<0x00098000 0x00002000>,
					<0x0009A000 0x00002000>,
					<0x0009C000 0x00002000>,
					<0x0009E000 0x00002000>;
				reg-names = "adxcvr", "adxcfg-0", "adxcfg-1", "adxcfg-2",
					"adxcfg-3", "adxcfg-4", "adxcfg-5", "adxcfg-6",
					"adxcfg-7", "adxcfg-8", "adxcfg-9", "adxcfg-10",
					"adxcfg-11", "adxcfg-12", "adxcfg-13", "adxcfg-14",
					"adxcfg-15";

				adi,stratix10;

				clocks = <&ltc6952 6>, <&ad9213_1_link_pll>;
				clock-names = "ref", "link";

				#clock-cells = <0>;
				clock-output-names = "jesd204_1_lane_clock";
			};

			ad9213_0_jesd: ad9213_0_jesd204@C0000 {
				compatible = "adi,axi-jesd204-rx-1.0";
				reg = <0x000C0000 0x4000>;

				interrupt-parent = <&intc>;
				interrupts = <0 28 4>;

				clocks = <&sys_clk>, <&ad9213_0_link_pll>, <&ad9213_0_adxcvr 0>;
				clock-names = "s_axi_aclk", "device_clk", "lane_clk";

				#clock-cells = <0>;
				clock-output-names = "jesd_0_lane_clk";

				adi,octets-per-frame = <AD9213_JESD_F>;
				adi,frames-per-multiframe = <AD9213_JESD_K>;
				adi,subclass = <AD9213_JESD_SUBCLASS>;

				adi,sysref-lmfc-offset = <8>;
			};

			ad9213_1_jesd: ad9213_1_jesd204@C8000 {
				compatible = "adi,axi-jesd204-rx-1.0";
				reg = <0x000C8000 0x4000>;

				interrupt-parent = <&intc>;
				interrupts = <0 29 4>;

				clocks = <&sys_clk>, <&ad9213_1_link_pll>, <&ad9213_1_adxcvr 0>;
				clock-names = "s_axi_aclk", "device_clk", "lane_clk";

				#clock-cells = <0>;
				clock-output-names = "jesd_1_lane_clk";

				adi,octets-per-frame = <AD9213_JESD_F>;
				adi,frames-per-multiframe = <AD9213_JESD_K>;
				adi,subclass = <AD9213_JESD_SUBCLASS>;

				adi,sysref-lmfc-offset = <8>;
			};

			rx_dma: dma@D2000 {
				compatible = "adi,axi-dmac-1.00.a";
				reg = <0x000D2000 0x10000>;
				#dma-cells = <1>;
				#clock-cells = <0>;
				interrupts = <0 30 4>;
				clocks = <&dma_clk>;

				adi,channels {
					#size-cells = <0>;
					#address-cells = <1>;

					dma-channel@0 {
						reg = <0>;
						adi,source-bus-width = <1024>;
						adi,source-bus-type = <2>;
						adi,destination-bus-width = <128>;
						adi,destination-bus-type = <0>;
					};
				};
			};

			axi_ad9213_core_rx: axi-ad9213-rx-hpc@D0000 {
				//compatible = "adi,axi-ad9371-rx-1.0";
				compatible = "xlnx,axi-ad-mc-adc-1.00.a";
				reg = <0x000D0000 0x00002000>;
				dmas = <&rx_dma 0>;
				dma-names = "ad-mc-adc-dma";
				//spibus-connected = <&ad9213_0>;
			};
		};
	};
};