// SPDX-License-Identifier: GPL-2.0-only
// Definitions for Analog Devices ADAQ4003 ADC
/dts-v1/;
/plugin/;

/ {
	compatible = "brcm,bcm2835", "brcm,bcm2711";
};

&{/} {
	adc_vref: regulator-vref {
		compatible = "regulator-fixed";
		regulator-name = "EVAL 5V Vref";
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		regulator-always-on;
	};

	adc_vdd: regulator-vdd {
		compatible = "regulator-fixed";
		regulator-name = "Eval VDD supply";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		regulator-always-on;
	};

	adc_vio: regulator-vio {
		compatible = "regulator-fixed";
		regulator-name = "Eval VIO supply";
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-always-on;
	};
};

&spi0 {
	status = "disabled";
};

&spidev0 {
	status = "disabled";
};

&spidev1 {
	status = "disabled";
};

&{/} {
	spi2 {
		compatible = "spi-gpio";
		#address-cells = <0x1>;
		#size-cells = <0x0>;

		sck-gpios = <&gpio 11 0>;
		miso-gpios = <&gpio 9 0>;
		mosi-gpios = <&gpio 10 0>;
		cs-gpios = <&gpio 8 0>;
		num-chipselects = <1>;

		status = "okay";

		adaq4003@0 {
			compatible = "adi,adaq4003";
			reg = <0>;
			//spi-max-frequency = <80000000>; //doesn't work
			//spi-max-frequency = <80000>; //sclk doesn't look good
			//spi-max-frequency = <10000>; //sclk looks good
			spi-max-frequency = <1000>; //sclk always looks great
			spi-cpha;
			//adi,spi-mode = "single";
			vdd-supply = <&adc_vdd>;
			vio-supply = <&adc_vio>;
			ref-supply = <&adc_vref>;
			adi,high-z-input;
			adi,gain-milli = <454>;
		};
	};
};
